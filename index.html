<style>
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
    .modal-content { background: #0a1118; border: 1px solid var(--neon); padding: 30px; border-radius: 20px; width: 80%; }
    .choice-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--neon); color: white; padding: 15px; margin: 10px 0; width: 100%; border-radius: 10px; cursor: pointer; }
</style>

<div class="glass-card" style="display: flex; gap: 10px; padding: 10px;">
    <button onclick="openDepModal('STARS')" style="flex:1; color:gold; border:1px solid gold; background:none; border-radius:10px; padding:10px;">‚≠ê STARS</button>
    <button onclick="openDepModal('TON')" style="flex:1; color:#0088cc; border:1px solid #0088cc; background:none; border-radius:10px; padding:10px;">üíé TON</button>
    <button onclick="openDepModal('USDT')" style="flex:1; color:#26a17b; border:1px solid #26a17b; background:none; border-radius:10px; padding:10px;">üíµ USDT</button>
</div>

<div id="depModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle" style="color:var(--neon)">D√©p√¥t</h3>
        <input type="number" id="depAmount" class="input-bet" style="width:90%" placeholder="Montant">
        <div id="platformChoice">
            <button class="choice-btn" onclick="confirmDeposit('XROCKET')">üöÄ via xRocket</button>
            <button class="choice-btn" onclick="confirmDeposit('CRYPTOBOT')">ü§ñ via CryptoBot</button>
        </div>
        <button onclick="closeModal()" style="background:none; border:none; color:grey; margin-top:10px;">Annuler</button>
    </div>
</div>

<script>
    let selectedAsset = '';

    function openDepModal(asset) {
        selectedAsset = asset;
        const min = { STARS: 5, TON: 0.2, USDT: 0.4 };
        document.getElementById('modalTitle').innerText = `D√©p√¥t ${asset} (Min: ${min[asset]})`;
        document.getElementById('depModal').style.display = 'flex';
        
        // Cacher les plateformes si c'est des Stars
        document.getElementById('platformChoice').style.display = (asset === 'STARS') ? 'none' : 'block';
        if(asset === 'STARS') {
            const btnStars = document.createElement('button');
            btnStars.className = "choice-btn";
            btnStars.innerText = "‚≠ê Payer en Stars";
            btnStars.onclick = () => confirmDeposit('TELEGRAM');
            btnStars.id = "tmpBtn";
            document.getElementById('modalContent').appendChild(btnStars);
        }
    }

    function closeModal() {
        document.getElementById('depModal').style.display = 'none';
        if(document.getElementById('tmpBtn')) document.getElementById('tmpBtn').remove();
    }

    async function confirmDeposit(platform) {
        const amount = document.getElementById('depAmount').value;
        if(!amount) return alert("Entrez un montant");

        const r = await fetch('/api/deposit', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id: userId, asset: selectedAsset, amount: amount, platform: platform })
        });
        
        const d = await r.json();
        if(d.success) {
            tg.openTelegramLink(d.url);
            closeModal();
        } else {
            tg.showAlert(d.message);
        }
    }
</script>
