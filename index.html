<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>STARRUSSI WORLD</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #00f2ff; --gold: #ffcc00; --bg: #050505; --card: #121212; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; text-align: center; overflow-x: hidden; }
        
        /* Glassmorphism Header */
        .top-bar { padding: 40px 20px; background: linear-gradient(135deg, #1a1a1a 0%, #050505 100%); border-bottom: 2px solid var(--accent); }
        .balance-title { font-size: 10px; letter-spacing: 3px; opacity: 0.6; }
        .balance-main { font-size: 50px; font-weight: 900; text-shadow: 0 0 15px var(--accent); }

        /* Smooth Navigation */
        .nav { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .nav-btn { padding: 10px 20px; border-radius: 30px; border: 1px solid #333; font-size: 12px; font-weight: bold; transition: 0.3s; }
        .nav-btn.active { background: var(--accent); color: black; border-color: var(--accent); }

        /* Real Casino Slots Animation */
        .slot-machine { background: var(--card); padding: 30px; border-radius: 25px; margin: 15px; border: 1px solid #222; }
        .reels { display: flex; justify-content: center; gap: 10px; margin: 20px 0; font-size: 60px; height: 100px; perspective: 1000px; }
        .reel { transition: transform 0.5s cubic-bezier(.45,.05,.55,.95); }
        .spinning { animation: roll 0.1s infinite linear; }
        @keyframes roll { 0% { transform: translateY(-10px); } 100% { transform: translateY(10px); } }

        .btn-spin { background: linear-gradient(to right, #00f2ff, #0066ff); color: white; border: none; padding: 20px; width: 100%; border-radius: 15px; font-size: 20px; font-weight: 900; box-shadow: 0 5px 20px rgba(0, 242, 255, 0.4); }
        
        /* Payment Grid */
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .pay-card { background: #1a1a1a; padding: 20px; border-radius: 15px; border: 1px solid #333; }
        input { background: #000; border: 1px solid #333; color: white; padding: 15px; width: 80%; border-radius: 10px; margin: 10px 0; }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="balance-title">TOTAL ASSETS</div>
    <div class="balance-main"><span id="bal">0.00</span> <small style="font-size: 15px;">TON</small></div>
</div>

<div class="nav">
    <div class="nav-btn active" onclick="show('games')">GAMES</div>
    <div class="nav-btn" onclick="show('cash')">CASHIER</div>
</div>

<div id="view-games">
    <div class="slot-machine">
        <div class="reels" id="reels">
            <div class="reel" id="r1">üé∞</div>
            <div class="reel" id="r2">üé∞</div>
            <div class="reel" id="r3">üé∞</div>
        </div>
        <input type="number" id="bet" value="0.2" step="0.1">
        <button class="btn-spin" onclick="play()">SPIN</button>
    </div>
</div>

<div id="view-cash" style="display:none;">
    <div class="pay-grid">
        <div class="pay-card" onclick="deposit('STARS')">‚≠ê STARS<br><small>Min: 5</small></div>
        <div class="pay-card" onclick="deposit('TON')">üíé CRYPTO<br><small>Min: 0.2</small></div>
    </div>
    <hr style="border: 0.5px solid #222;">
    <h3>WITHDRAW</h3>
    <select id="wMethod" style="padding: 15px; width: 90%; background: #1a1a1a; color: white; border-radius: 10px;">
        <option value="CRYPTOBOT">CryptoBot (Min 1 TON)</option>
        <option value="AIRTEL">Airtel Money (Min 3 TON)</option>
    </select>
    <input type="text" id="wDetails" placeholder="Wallet or Phone Number">
    <input type="number" id="wAmount" placeholder="Amount TON">
    <button class="btn-spin" style="background: #ff4444;" onclick="withdraw()">WITHDRAW NOW</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const uid = tg.initDataUnsafe.user?.id || 7019851823;

    function show(v) {
        document.getElementById('view-games').style.display = v === 'games' ? 'block' : 'none';
        document.getElementById('view-cash').style.display = v === 'cash' ? 'block' : 'none';
    }

    async function sync() {
        const r = await fetch('/api/user-data', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid})});
        const d = await r.json();
        document.getElementById('bal').innerText = d.balance.toFixed(2);
    }

    async function play() {
        const bet = document.getElementById('bet').value;
        const reels = [document.getElementById('r1'), document.getElementById('r2'), document.getElementById('r3')];
        reels.forEach(r => r.classList.add('spinning'));

        const r = await fetch('/api/play', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, bet, game:'slots'})
        });
        const d = await r.json();

        setTimeout(() => {
            reels.forEach((r, i) => {
                r.classList.remove('spinning');
                r.innerText = d.result[i];
            });
            if (d.error) tg.showAlert(d.error);
            sync();
        }, 1000);
    }

    async function deposit(asset) {
        const amount = prompt(`Enter amount (${asset}):`);
        const r = await fetch('/api/deposit', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, asset, amount})
        });
        const d = await r.json();
        if (d.url) tg.openTelegramLink(d.url);
        else tg.showAlert(d.message || "Error");
    }

    async function withdraw() {
        const amount = document.getElementById('wAmount').value;
        const method = document.getElementById('wMethod').value;
        const details = document.getElementById('wDetails').value;
        const r = await fetch('/api/withdraw', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, amount, method, details})
        });
        const d = await r.json();
        tg.showAlert(d.message);
        sync();
    }

    sync();
</script>
</body>
</html>
