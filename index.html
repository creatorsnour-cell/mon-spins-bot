<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --blue: #0088cc; --dark: #0f172a; --card: #1e293b; }
        body { background: var(--dark); color: white; font-family: sans-serif; margin: 0; padding-bottom: 80px; }
        .header { background: var(--card); padding: 20px; border-bottom: 2px solid var(--blue); }
        .balances { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .balance-item { background: var(--dark); padding: 10px; border-radius: 10px; font-size: 14px; }
        .balance-item span { display: block; color: var(--blue); font-size: 18px; font-weight: bold; }

        .game-zone { padding: 20px; text-align: center; }
        .wheel-container { position: relative; width: 280px; height: 280px; margin: 20px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #334155; transition: transform 4s cubic-bezier(0.1, 0, 0, 1);
            background: conic-gradient(#ef4444 0 60deg, #3b82f6 60deg 120deg, #fbbf24 120deg 180deg, #10b981 180deg 240deg, #8b5cf6 240deg 300deg, #f97316 300deg 360deg);
        }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 30px solid gold; z-index: 10; }

        .controls { background: var(--card); padding: 20px; border-radius: 20px; margin: 0 20px; }
        input, select { background: var(--dark); border: 1px solid #334155; color: white; padding: 12px; border-radius: 10px; width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        .btn-main { background: var(--blue); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; font-size: 16px; cursor: pointer; }

        .nav { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #334155; }
        .nav-btn { font-size: 12px; color: #94a3b8; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body>

    <div class="header">
        <strong>ðŸ’° MON PORTEFEUILLE</strong>
        <div class="balances">
            <div class="balance-item">Solde TON <span id="ton-bal">0.00</span></div>
            <div class="balance-item">Solde USDT <span id="usdt-bal">0.00</span></div>
        </div>
    </div>

    <div class="game-zone">
        <div class="wheel-container">
            <div class="pointer"></div>
            <div id="wheel"></div>
        </div>

        <div class="controls">
            <input type="number" id="betAmount" placeholder="Montant du pari">
            <select id="assetSelect">
                <option value="TON">TON</option>
                <option value="USDT">USDT</option>
            </select>
            <button class="btn-main" onclick="play()">PARIER ET TOURNER</button>
            <button onclick="deposit()" style="margin-top:10px; background:none; color:var(--blue); border:none; cursor:pointer;">+ DÃ©poser des fonds</button>
        </div>
    </div>

    <div class="nav">
        <button class="nav-btn">ðŸŽ¡ Jeu</button>
        <button class="nav-btn" onclick="withdrawPrompt()">ðŸ“¤ Retrait</button>
        <button class="nav-btn">ðŸ‘¥ Amis</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        let user = { id: tg.initDataUnsafe.user?.id || 123, name: tg.initDataUnsafe.user?.first_name || "Guest" };
        let currentRotation = 0;

        async function init() {
            const r = await fetch('/api/auth', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(user) });
            const data = await r.json();
            document.getElementById('ton-bal').innerText = data.balance_ton.toFixed(2);
            document.getElementById('usdt-bal').innerText = data.balance_usdt.toFixed(2);
        }

        async function deposit() {
            const amount = prompt("Combien voulez-vous dÃ©poser ?");
            const asset = document.getElementById('assetSelect').value;
            if(!amount || amount <= 0) return;

            const r = await fetch('/api/deposit', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ amount, asset }) });
            const data = await r.json();
            if(data.success) tg.openTelegramLink(data.pay_url);
        }

        function play() {
            const bet = document.getElementById('betAmount').value;
            if(!bet || bet <= 0) return alert("Misez un montant !");
            
            tg.HapticFeedback.impactOccurred('heavy');
            currentRotation += Math.floor(Math.random() * 360) + 1800;
            document.getElementById('wheel').style.transform = `rotate(${currentRotation}deg)`;
            
            setTimeout(() => {
                alert("RÃ©sultat du tirage enregistrÃ© !");
                tg.HapticFeedback.notificationOccurred('success');
            }, 4000);
        }

        function withdrawPrompt() {
            const addr = prompt("Entrez votre adresse de retrait :");
            if(addr) alert("Demande enregistrÃ©e. Traitement sous 24h.");
        }

        init();
    </script>
</body>
</html>
