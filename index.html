<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>STARRUSSI TITAN</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Share+Tech+Mono&display=swap');
        :root { --neon: #00f2ff; --purple: #bc13fe; --dark: #020205; }
        body { background: var(--dark); color: white; font-family: 'Share Tech Mono', monospace; margin: 0; padding-bottom: 90px; }
        
        .cyber-header { padding: 30px 20px; background: linear-gradient(180deg, #0d0d1a, var(--dark)); border-bottom: 2px solid var(--neon); text-align: center; }
        .bal-val { font-family: 'Orbitron'; font-size: 45px; color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        /* Trading Bar */
        .market-scroll { display: flex; overflow-x: auto; background: #0a0a14; padding: 10px; gap: 20px; border-bottom: 1px solid #1a1a2e; }
        .coin-box { white-space: nowrap; font-size: 12px; }
        .up { color: #00ff88; } .down { color: #ff4444; }

        /* Navigation */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(5,5,15,0.95); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid var(--neon); }
        .nav-item { color: #555; font-size: 10px; text-align: center; cursor: pointer; }
        .nav-item.active { color: var(--neon); transform: scale(1.1); }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 4px; }

        .tab-content { display: none; padding: 20px; animation: glitch 0.3s ease; }
        @keyframes glitch { 0% { opacity:0; } 100% { opacity:1; } }
        .active-tab { display: block; }

        .card { background: #0d0d1a; border: 1px solid #1a1a2e; border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: 0 0 15px rgba(0,242,255,0.1); }
        .btn-cyber { background: var(--neon); color: black; border: none; padding: 15px; width: 100%; border-radius: 10px; font-family: 'Orbitron'; font-weight: 900; letter-spacing: 1px; }

        /* Trading Chart Mockup */
        .chart-container { height: 120px; display: flex; align-items: flex-end; gap: 5px; margin: 15px 0; }
        .bar { flex: 1; background: var(--neon); min-height: 20px; border-radius: 2px 2px 0 0; opacity: 0.7; transition: 0.5s; }
    </style>
</head>
<body>

<div class="market-scroll" id="ticker">
    <div class="coin-box">BTC <span class="up" id="price-btc">$94,210 â†‘</span></div>
    <div class="coin-box">TON <span class="down" id="price-ton">$5.42 â†“</span></div>
    <div class="coin-box">SOL <span class="up" id="price-sol">$142.1 â†‘</span></div>
    <div class="coin-box">USDT <span class="up">$1.00</span></div>
</div>

<div class="cyber-header">
    <div style="font-size: 10px; letter-spacing: 3px; opacity: 0.5;">CORE_BALANCE</div>
    <div class="bal-val"><span id="bal">0.00</span> <small style="font-size:12px;">TON</small></div>
</div>

<div id="tab-trade" class="tab-content active-tab">
    <div class="card">
        <h3>ðŸ“Š REAL-TIME ANALYSIS</h3>
        <div class="chart-container" id="chart"></div>
        <div id="trade-res" style="text-align:center; font-size:20px; margin:10px 0;">IDLE...</div>
        <button class="btn-cyber" onclick="play('trade')">OPEN POSITION</button>
    </div>
</div>

<div id="tab-games" class="tab-content">
    <div class="card" style="text-align:center;">
        <div id="game-res" style="font-size:60px; margin:20px">ðŸŽ°</div>
        <select id="gameType" style="width:100%; padding:15px; background:black; color:white; border:1px solid var(--neon); border-radius:10px; margin-bottom:10px;">
            <option value="slots">SLOTS MACHINE</option>
            <option value="dice">QUANTUM DICE ðŸŽ²</option>
        </select>
        <input type="number" id="bet" value="0.2" step="0.1" style="width:100%; padding:15px; background:black; border:1px solid #333; color:white; border-radius:10px; margin-bottom:15px; box-sizing:border-box;">
        <button class="btn-cyber" onclick="play()">EXECUTE BET</button>
    </div>
</div>

<div id="tab-squad" class="tab-content">
    <div class="card">
        <h3>ðŸ“¡ MISSIONS</h3>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span>JOIN CHANNEL @starrussi</span>
            <button class="btn-cyber" style="width:auto; padding:10px;" onclick="checkTask()">CHECK</button>
        </div>
    </div>
    <div class="card">
        <h3>ðŸ‘¥ SQUAD LINK</h3>
        <div id="ref-link" style="font-size:10px; background:#000; padding:15px; border:1px dashed var(--neon); word-break:break-all;">...</div>
        <button class="btn-cyber" style="margin-top:10px;" onclick="shareRef()">SHARE DATA LINK</button>
    </div>
</div>

<div id="tab-wallet" class="tab-content">
    <div class="card">
        <h4>WITHDRAW EXTRACTION</h4>
        <select id="wMethod" style="width:100%; padding:15px; background:black; color:white; border-radius:10px; margin-bottom:10px;">
            <option value="CRYPTOBOT">CryptoBot (Min 1 TON)</option>
            <option value="AIRTEL">Airtel Money (Min 3 TON)</option>
        </select>
        <input type="text" id="wDetails" placeholder="CoordonnÃ©es" style="width:100%; padding:15px; background:black; border:1px solid #333; color:white; border-radius:10px; margin-bottom:10px; box-sizing:border-box;">
        <input type="number" id="wAmt" placeholder="Montant TON" style="width:100%; padding:15px; background:black; border:1px solid #333; color:white; border-radius:10px; margin-bottom:10px; box-sizing:border-box;">
        <button class="btn-cyber" onclick="withdraw()">START WITHDRAWAL</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('trade', this)"><i class="fas fa-chart-line"></i>TRADE</div>
    <div class="nav-item" onclick="switchTab('games', this)"><i class="fas fa-rocket"></i>PLAY</div>
    <div class="nav-item" onclick="switchTab('squad', this)"><i class="fas fa-users"></i>SQUAD</div>
    <div class="nav-item" onclick="switchTab('wallet', this)"><i class="fas fa-wallet"></i>WALLET</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const uid = tg.initDataUnsafe.user?.id || 7019851823;
    const uname = tg.initDataUnsafe.user?.first_name || "Agent";
    let refLink = "";

    function switchTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.getElementById('tab-'+id).classList.add('active-tab');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        tg.HapticFeedback.impactOccurred('medium');
    }

    // Animation de graphique
    function updateChart() {
        const chart = document.getElementById('chart');
        chart.innerHTML = "";
        for(let i=0; i<15; i++) {
            const h = Math.floor(Math.random()*80) + 20;
            chart.innerHTML += `<div class="bar" style="height:${h}px"></div>`;
        }
        // Simuler prix
        document.getElementById('price-btc').innerText = `$${(94000 + Math.random()*500).toFixed(0)} â†‘`;
    }
    setInterval(updateChart, 2000);

    async function sync() {
        const r = await fetch('/api/user-data', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, username:uname})
        });
        const d = await r.json();
        document.getElementById('bal').innerText = d.balance.toFixed(2);
        refLink = d.refLink;
        document.getElementById('ref-link').innerText = refLink;
    }

    async function play(type = null) {
        const bet = document.getElementById('bet').value;
        const game = type || document.getElementById('gameType').value;
        tg.HapticFeedback.impactOccurred('heavy');

        const r = await fetch('/api/play', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, bet, game})
        });
        const d = await r.json();
        
        if(d.error) return tg.showAlert(d.error);

        if(game === 'trade') {
            document.getElementById('trade-res').innerText = d.result;
            document.getElementById('trade-res').className = d.win > 0 ? "up" : "down";
        } else {
            document.getElementById('game-res').innerText = Array.isArray(d.result) ? d.result.join('') : d.result;
        }
        
        tg.HapticFeedback.notificationOccurred(d.win > 0 ? 'success' : 'error');
        sync();
    }

    async function checkTask() {
        const r = await fetch('/api/check-task', {
            method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id:uid})
        });
        const d = await r.json();
        tg.showAlert(d.message);
        sync();
    }

    async function withdraw() {
        const amount = document.getElementById('wAmt').value;
        const method = document.getElementById('wMethod').value;
        const details = document.getElementById('wDetails').value;
        const r = await fetch('/api/withdraw', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, amount, method, details})
        });
        const d = await r.json();
        tg.showAlert(d.message);
        sync();
    }

    function shareRef() {
        tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=Join me on STARRUSSI TITAN!`);
    }

    sync();
    updateChart();
</script>
</body>
</html>
