<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; margin: 0; text-align: center; }
        .header { background: #1e293b; padding: 15px; border-bottom: 2px solid #38bdf8; }
        .balance { font-size: 24px; font-weight: bold; color: #38bdf8; }
        .game-card { background: #1e293b; margin: 15px; padding: 20px; border-radius: 15px; border: 1px solid #334155; }
        .result-display { font-size: 50px; margin: 20px 0; height: 60px; }
        input, select { width: 80%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; }
        .btn-play { background: #38bdf8; color: #0f172a; padding: 15px 40px; border-radius: 30px; font-weight: bold; border: none; width: 80%; }
        .nav { position: fixed; bottom: 0; width: 100%; background: #1e293b; display: flex; padding: 10px 0; }
        .nav div { flex: 1; font-size: 12px; }
    </style>
</head>
<body>
    <div class="header">
        <div>SOLDE : <span id="userBal" class="balance">100.00</span></div>
    </div>

    <div class="game-card">
        <h3>üé∞ SALLE DE JEU</h3>
        <select id="gameType">
            <option value="slots">MACHINE √Ä SOUS (x10)</option>
            <option value="dice">LANCER DE D√âS (x2)</option>
        </select>
        <div id="display" class="result-display">üé∞</div>
        <input type="number" id="betAmount" placeholder="Mise (Ex: 10)">
        <button class="btn-play" onclick="playGame()">PARIER</button>
    </div>

    <div class="game-card">
        <h3>üí≥ PORTEFEUILLE</h3>
        <button onclick="deposit('STARS')" style="background:#fbbf24; border:none; padding:10px; border-radius:5px;">D√©poser ‚≠ê Stars</button>
        <button onclick="deposit('TON')" style="background:#0088cc; border:none; padding:10px; border-radius:5px; color:white;">D√©poser TON</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        let balance = 100;

        async function playGame() {
            const bet = parseFloat(document.getElementById('betAmount').value);
            const gameType = document.getElementById('gameType').value;
            if (bet > balance || bet <= 0) return alert("Solde insuffisant !");

            balance -= bet; updateUI();
            tg.HapticFeedback.impactOccurred('heavy');

            const r = await fetch('/api/play', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ bet, gameType })
            });
            const data = await r.json();

            document.getElementById('display').innerText = "‚è≥";
            setTimeout(() => {
                document.getElementById('display').innerText = data.resultValue;
                balance += data.win;
                updateUI();
                if(data.win > 0) tg.HapticFeedback.notificationOccurred('success');
            }, 1000);
        }

        async function deposit(asset) {
            const amount = prompt("Montant du d√©p√¥t ?");
            const r = await fetch('/api/deposit', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ amount, asset })
            });
            const data = await r.json();
            if(data.success) tg.openTelegramLink(data.url);
        }

        function updateUI() { document.getElementById('userBal').innerText = balance.toFixed(2); }
    </script>
</body>
</html>
