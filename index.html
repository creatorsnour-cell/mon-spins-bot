<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon: #00d2ff; --bg: #0a0a0b; --card: #151517; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* Animations */
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: 24px; margin: 15px; padding: 25px; border: 1px solid #222; animation: slideIn 0.5s ease-out; }
        .balance-val { font-size: 38px; font-weight: 800; color: var(--neon); text-shadow: 0 0 15px rgba(0,210,255,0.3); }
        
        .grid-games { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0 15px; }
        .game-btn { background: #1c1c1e; padding: 20px 10px; border-radius: 18px; border: 1px solid #333; transition: 0.3s; cursor: pointer; }
        .active-game { border-color: var(--neon); background: rgba(0,210,255,0.15); box-shadow: 0 0 15px rgba(0,210,255,0.1); }
        
        .display-area { font-size: 60px; height: 100px; display: flex; align-items: center; justify-content: center; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .spinning { animation: pulse 0.2s infinite; filter: blur(2px); }

        .btn { width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-play { background: linear-gradient(90deg, #00d2ff, #3a7bd5); color: white; box-shadow: 0 4px 15px rgba(0,210,255,0.3); }
        .btn-crypto { background: #222; color: #fff; border: 1px solid #444; }
        .btn:active { transform: scale(0.98); }
    </style>
</head>
<body>

<div class="card">
    <div style="opacity: 0.5; font-size: 13px; letter-spacing: 1px;">TON BALANCE</div>
    <div id="bal" class="balance-val">0.00</div>
</div>

<div class="grid-games">
    <div id="g-dice" class="game-btn active-game" onclick="setG('dice')">üé≤<br>D√©s</div>
    <div id="g-casino" class="game-btn" onclick="setG('casino')">üé∞<br>Slots</div>
    <div id="g-mines" class="game-btn" onclick="setG('mines')">üí£<br>Mines</div>
</div>

<div class="card" style="text-align: center;">
    <div id="display" class="display-area">üé≤</div>
    <input type="number" id="bet" placeholder="Mise en TON" style="width: 80%; background: #1c1c1e; border: 1px solid #333; color: white; padding: 12px; border-radius: 10px; text-align: center;">
    <button class="btn btn-play" onclick="play()">LANCER LE JEU</button>
</div>

<div class="card">
    <button class="btn" style="background:#ffbc00; color:black;" onclick="payStars()">‚≠ê RECHARGE √âTOILES</button>
    <button class="btn btn-crypto" onclick="payCrypto()">üíé D√âP√îT TON (CRYPTOBOT)</button>
    <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
        <input type="number" id="wit-amt" placeholder="Montant Retrait" style="width: 80%; background: #1c1c1e; border: 1px solid #333; color: white; padding: 12px; border-radius: 10px; text-align: center; margin-bottom: 10px;">
        <button class="btn" style="background:#ff4444;" onclick="withdraw()">RETIRER VERS CRYPTOBOT</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const uid = tg.initDataUnsafe.user?.id || 7019851823;

    async function play() {
        const display = document.getElementById('display');
        display.classList.add('spinning');
        
        // Simuler un d√©lai d'animation
        setTimeout(async () => {
            const bet = document.getElementById('bet').value;
            const r = await fetch('/api/play', { method:'POST', headers:{'Content-Type':'application/json'}, 
                body:JSON.stringify({id:uid, bet, game:curG, minesCount: 3}) 
            });
            const d = await r.json();
            display.classList.remove('spinning');
            
            if(d.error) return tg.showAlert(d.error);
            display.innerText = Array.isArray(d.result) ? d.result.join('') : d.result;
            if(d.win > 0) tg.HapticFeedback.notificationOccurred('success');
            sync();
        }, 600);
    }

    async function payCrypto() {
        const amt = prompt("Montant TON √† d√©poser :");
        if(!amt) return;
        const r = await fetch('/api/deposit-crypto', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, amount:amt}) });
        const d = await r.json();
        if(d.url) tg.openTelegramLink(d.url);
    }

    async function withdraw() {
        const amt = document.getElementById('wit-amt').value;
        const r = await fetch('/api/withdraw-crypto', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, amount:amt}) });
        const d = await r.json();
        tg.showAlert(d.message || d.error);
        sync();
    }
    
    // Reste des fonctions Sync et SetG...
</script>
</body>
</html>
