<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon: #00d2ff; }
        body { background: #050505; color: white; font-family: sans-serif; text-align: center; margin: 0; }
        .card { background: #111; border-radius: 20px; margin: 15px; padding: 20px; border: 1px solid #222; }
        .balance { font-size: 35px; font-weight: bold; color: var(--neon); }
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-play { background: var(--neon); color: black; }
        .btn:active { transform: scale(0.95); }
        #display { font-size: 70px; height: 100px; display: flex; align-items: center; justify-content: center; }
        .win-anim { animation: win 0.5s infinite alternate; }
        @keyframes win { from { transform: scale(1); text-shadow: none; } to { transform: scale(1.2); text-shadow: 0 0 20px gold; } }
    </style>
</head>
<body>

<div class="card">
    <div style="opacity: 0.5; font-size: 12px;">SOLDE DISPONIBLE</div>
    <div id="bal" class="balance">0.00 TON</div>
</div>

<div class="card">
    <div id="display">üé≤</div>
    <input type="number" id="bet" placeholder="Mise TON" style="width: 80%; padding: 10px; border-radius: 8px; border: none; background: #222; color: white; text-align: center;">
    <button class="btn btn-play" onclick="play()">JOUER (x3)</button>
</div>

<div class="card">
    <button class="btn" style="background:#ffbc00;" onclick="payStars()">‚≠ê D√âP√îT STARS</button>
    <button class="btn" style="background:#222; color:white; border:1px solid #444;" onclick="payCrypto()">üíé D√âP√îT CRYPTOBOT</button>
    <button class="btn" style="background:#ff4444; color:white;" onclick="withdraw()">RETRAIT TON</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const uid = tg.initDataUnsafe.user?.id || 7019851823;

    async function sync() {
        const r = await fetch('/api/user-data', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid}) });
        const d = await r.json(); 
        document.getElementById('bal').innerText = d.balance.toFixed(2) + " TON";
    }

    async function play() {
        const bet = document.getElementById('bet').value;
        const disp = document.getElementById('display');
        disp.innerText = "‚è≥";
        const r = await fetch('/api/play', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, bet, game:'dice'}) });
        const d = await r.json();
        
        setTimeout(() => {
            if(d.error) return tg.showAlert(d.error);
            disp.innerText = d.result;
            if(d.win > 0) {
                disp.classList.add('win-anim');
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                disp.classList.remove('win-anim');
            }
            sync();
        }, 500);
    }

    async function payStars() {
        const amt = prompt("√âtoiles √† acheter (XTR):");
        if(!amt) return;
        const r = await fetch('/api/deposit-stars', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, amount:amt}) });
        const d = await r.json();
        if(d.url) tg.openTelegramLink(d.url);
    }

    async function payCrypto() {
        const amt = prompt("Montant TON:");
        const r = await fetch('/api/deposit-crypto', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, amount:amt}) });
        const d = await r.json();
        if(d.url) tg.openTelegramLink(d.url);
    }

    async function withdraw() {
        const amt = prompt("Montant TON √† retirer:");
        const r = await fetch('/api/withdraw', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({id:uid, amount:amt}) });
        const d = await r.json();
        tg.showAlert(d.success ? "Retrait envoy√© !" : d.error);
        sync();
    }

    sync();
    setInterval(sync, 10000); // Sync auto pour voir les d√©p√¥ts
</script>
</body>
</html>
