<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Games - Fintech Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon-blue: #00d2ff; --dark-bg: #0a0a0a; }
        body { background: var(--dark-bg); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; }
        .card { background: #1a1a1a; border: 1px solid #333; border-radius: 20px; margin: 15px; padding: 20px; }
        .balance-value { font-size: 32px; color: var(--neon-blue); font-weight: bold; }
        .btn-play { background: var(--neon-blue); color: black; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; margin-top: 10px; }
        
        /* Animation du d√©p√¥t spin-bot */
        .spinning { animation: rotate 0.5s infinite linear; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="card">
        <p>SOLDE ACTUEL</p>
        <div class="balance-value"><span id="user-bal">0.00</span> TON</div>
    </div>

    <div class="card" id="game-zone">
        <div id="dice-display" style="font-size: 60px;">üé≤</div>
        <input type="number" id="bet-amount" placeholder="Mise (ex: 0.1)" style="width: 80%; padding: 10px; margin: 10px; border-radius: 8px;">
        <button class="btn-play" onclick="startSpin()">PLAY NOW</button>
    </div>

    <div class="card">
        <button onclick="deposit('TON', 'CRYPTOBOT')" style="color: white; background: none; border: 1px solid #444; padding: 10px; border-radius: 8px;">RECHARGE VIA CRYPTOBOT</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const userId = tg.initDataUnsafe.user?.id || 7019851823;

        async function startSpin() {
            const dice = document.getElementById('dice-display');
            dice.classList.add('spinning'); // Animation issue du bot
            
            const bet = document.getElementById('bet-amount').value;
            const res = await fetch('/api/play', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: userId, bet: parseFloat(bet), game: 'dice' })
            });
            const data = await res.json();

            setTimeout(() => {
                dice.classList.remove('spinning');
                if(data.error) return tg.showAlert(data.error);
                dice.innerText = 'üé≤ ' + data.result;
                document.getElementById('user-bal').innerText = data.balance.toFixed(2);
                if(data.win > 0) tg.showScanQrPopup({ text: "GAGN√â ! +" + data.win + " TON" });
            }, 1000);
        }

        async function deposit(asset, platform) {
            const amount = prompt("Montant √† d√©poser :");
            const res = await fetch('/api/deposit', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: userId, amount, asset, platform })
            });
            const data = await res.json();
            if(data.url) tg.openLink(data.url);
        }
    </script>
</body>
</html>
