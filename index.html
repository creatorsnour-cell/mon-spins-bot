<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon: #00f2ff; --pink: #ff0055; --bg: #03070b; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; overflow: hidden; }
        
        /* Design Futuriste */
        .app-container { height: 100vh; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; box-sizing: border-box; }
        .glass-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(0,242,255,0.2); border-radius: 25px; padding: 20px; backdrop-filter: blur(15px); box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        .balance-title { font-size: 10px; letter-spacing: 2px; color: var(--neon); opacity: 0.8; }
        .balance-value { font-size: 35px; font-weight: bold; text-shadow: 0 0 15px var(--neon); }

        /* Zone de Jeu Dynamique */
        #game-zone { margin: 30px 0; min-height: 150px; display: flex; align-items: center; justify-content: center; }
        .slot-item { font-size: 60px; margin: 0 5px; transition: 0.3s; }
        .dice-item { font-size: 90px; filter: drop-shadow(0 0 10px var(--neon)); }

        .game-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .game-tab { padding: 10px 20px; border-radius: 15px; border: 1px solid var(--neon); font-size: 12px; cursor: pointer; opacity: 0.5; }
        .game-tab.active { opacity: 1; background: var(--neon); color: black; box-shadow: 0 0 15px var(--neon); }

        .input-bet { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: white; padding: 15px; border-radius: 15px; width: 60%; font-size: 18px; text-align: center; }
        .btn-play { background: linear-gradient(45deg, var(--neon), #0072ff); border: none; color: black; padding: 18px; border-radius: 15px; width: 100%; font-weight: bold; margin-top: 15px; cursor: pointer; }

        /* Animations */
        .spinning { animation: spin 0.1s infinite linear; }
        @keyframes spin { from { transform: rotateX(0deg); } to { transform: rotateX(360deg); } }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="glass-card">
            <div class="balance-title">NETWORK WALLET</div>
            <div class="balance-value" id="userBal">0.00</div>
        </div>

        <div>
            <div class="game-selector">
                <div class="game-tab active" id="tab-slots" onclick="switchGame('slots')">üé∞ CASINO</div>
                <div class="game-tab" id="tab-dice" onclick="switchGame('dice')">üé≤ D√âS</div>
            </div>

            <div class="glass-card">
                <div id="game-zone">
                    <span class="slot-item">üçí</span><span class="slot-item">üçí</span><span class="slot-item">üçí</span>
                </div>
                <input type="number" id="bet" class="input-bet" placeholder="MISE">
                <button class="btn-play" onclick="startGame()">PLACER LE PARI</button>
            </div>
        </div>

        <div class="glass-card" style="display: flex; gap: 10px; padding: 10px;">
            <button onclick="deposit()" style="flex:1; background:none; border:1px solid var(--neon); color:var(--neon); border-radius:10px; padding:10px; font-size:10px;">D√âP√îT</button>
            <button onclick="withdraw()" style="flex:1; background:none; border:1px solid var(--pink); color:var(--pink); border-radius:10px; padding:10px; font-size:10px;">RETRAIT</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let currentGame = 'slots';
        let userId = tg.initDataUnsafe.user?.id || 123;

        function switchGame(type) {
            currentGame = type;
            document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + type).classList.add('active');
            
            const zone = document.getElementById('game-zone');
            if(type === 'dice') {
                zone.innerHTML = '<span class="dice-item">üé≤</span>';
            } else {
                zone.innerHTML = '<span class="slot-item">üé∞</span><span class="slot-item">üé∞</span><span class="slot-item">üé∞</span>';
            }
        }

        async function startGame() {
            const bet = parseFloat(document.getElementById('bet').value);
            const zone = document.getElementById('game-zone');
            if (!bet || bet <= 0) return tg.showAlert("Mise invalide");

            zone.classList.add('spinning');

            const r = await fetch('/api/play', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: userId, bet, game: currentGame })
            });
            const data = await r.json();

            setTimeout(() => {
                zone.classList.remove('spinning');
                if(data.error) return tg.showAlert(data.error);

                if(currentGame === 'dice') {
                    const diceFaces = ['', '‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                    zone.innerHTML = `<span class="dice-item">${diceFaces[data.result]}</span>`;
                } else {
                    zone.innerHTML = data.result.map(i => `<span class="slot-item">${i}</span>`).join('');
                }
                
                document.getElementById('userBal').innerText = data.newBalance.toFixed(2);
                if(data.win > 0) tg.HapticFeedback.notificationOccurred('success');
            }, 1000);
        }

        async function deposit() {
            const asset = prompt("Monnaie (STARS / TON / USDT) ?").toUpperCase();
            const amount = prompt("Montant ?");
            let platform = 'CRYPTOBOT';
            if(asset !== 'STARS') platform = confirm("OK pour xRocket, Annuler pour CryptoBot") ? 'XROCKET' : 'CRYPTOBOT';

            const r = await fetch('/api/deposit', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: userId, asset, amount, platform })
            });
            const d = await r.json();
            if(d.success) tg.openTelegramLink(d.url);
            else tg.showAlert(d.message);
        }

        async function withdraw() {
            const asset = prompt("Monnaie ?");
            const amount = prompt("Montant ?");
            const address = prompt("Adresse ?");
            const r = await fetch('/api/withdraw', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: userId, name: "User", asset, amount, address })
            });
            const res = await r.json();
            tg.showAlert(res.message || "Erreur");
        }
    </script>
</body>
</html>
