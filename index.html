<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>STARRUSSI NEXUS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@500;700&display=swap');
        :root { --neon: #00f2ff; --purple: #bc13fe; --bg: #020408; --card: #0a0c16; }
        body { background: var(--bg); color: white; font-family: 'Rajdhani', sans-serif; margin: 0; padding-bottom: 100px; overflow-x: hidden; }

        /* Header avec Barre de Progression */
        .header { padding: 30px 20px; background: var(--card); border-bottom: 2px solid var(--neon); position: relative; }
        .bal-container { font-family: 'Orbitron'; font-size: 38px; color: var(--neon); text-shadow: 0 0 15px var(--neon); }
        .lvl-bar { width: 100%; height: 4px; background: #1a1a2e; margin-top: 10px; border-radius: 2px; }
        .lvl-progress { height: 100%; background: var(--purple); width: 0%; box-shadow: 0 0 10px var(--purple); transition: 0.5s; }

        /* Navigation */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(10, 12, 22, 0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #1a1a2e; z-index: 1000; }
        .nav-item { color: #4a5568; font-size: 11px; text-align: center; }
        .nav-item.active { color: var(--neon); text-shadow: 0 0 8px var(--neon); }
        .nav-item i { font-size: 22px; margin-bottom: 4px; }

        /* Tabs */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s ease; }
        .active-tab { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .glass-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 24px; padding: 20px; margin-bottom: 15px; }
        .cyber-btn { background: linear-gradient(90deg, var(--neon), var(--purple)); color: white; border: none; padding: 16px; width: 100%; border-radius: 14px; font-family: 'Orbitron'; font-weight: bold; font-size: 12px; cursor: pointer; border-bottom: 3px solid rgba(0,0,0,0.3); }
        .cyber-btn:active { transform: translateY(2px); border: none; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-item { background: #0d111d; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #1a1a2e; }

        /* Trading Anim */
        .trade-chart { height: 60px; display: flex; align-items: flex-end; gap: 4px; justify-content: center; margin: 15px 0; }
        .chart-bar { width: 8px; background: var(--neon); border-radius: 4px 4px 0 0; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { height: 10px; } to { height: 40px; } }
    </style>
</head>
<body>

<div class="header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <span style="font-size: 12px; letter-spacing: 2px;">USER_ID: <span id="uid-txt">...</span></span>
        <span class="lvl-badge" style="color: var(--purple);">RANK: <span id="lvl">1</span></span>
    </div>
    <div class="bal-container"><span id="bal">0.00</span> <small style="font-size:14px">TON</small></div>
    <div class="lvl-bar"><div class="lvl-progress" id="progress"></div></div>
</div>

<div id="tab-trade" class="tab-content active-tab">
    <div class="glass-card">
        <h3><i class="fas fa-chart-line"></i> QUANTUM TRADING</h3>
        <div class="trade-chart">
            <div class="chart-bar" style="animation-delay: 0.1s"></div>
            <div class="chart-bar" style="animation-delay: 0.3s"></div>
            <div class="chart-bar" style="animation-delay: 0.2s"></div>
            <div class="chart-bar" style="animation-delay: 0.4s"></div>
        </div>
        <div id="trade-res" style="text-align:center; font-size:24px; margin-bottom:15px; font-family:'Orbitron'">WAITING...</div>
        <button class="cyber-btn" onclick="playGame('trading')">EXECUTE TRADE</button>
    </div>
    
    <div class="stat-grid">
        <div class="stat-item"><b>BTC/TON</b><br><span style="color: var(--green)">+2.4%</span></div>
        <div class="stat-item"><b>XP EARNED</b><br><span id="xp-txt">0</span></div>
    </div>
</div>

<div id="tab-games" class="tab-content">
    <div class="glass-card" style="text-align:center">
        <div id="game-res" style="font-size:60px; margin:20px">ðŸŽ°</div>
        <select id="gameType" style="width:100%; padding:15px; background:black; color:white; border:1px solid var(--neon); border-radius:12px; margin-bottom:15px;">
            <option value="slots">CYBER SLOTS</option>
            <option value="dice">NEON DICE</option>
        </select>
        <input type="number" id="bet" value="0.2" step="0.1" style="width:100%; padding:15px; background:black; color:white; border-radius:12px; border:1px solid #1a1a2e; margin-bottom:15px; box-sizing:border-box">
        <button class="cyber-btn" onclick="playGame()">INITIATE SEQUENCE</button>
    </div>
</div>

<div id="tab-tasks" class="tab-content">
    <h3>DATA MISSIONS</h3>
    <div class="glass-card" style="display:flex; justify-content:space-between; align-items:center;">
        <div><b>Rejoindre Starrussi</b><br><small style="color:var(--neon)">+0.10 TON</small></div>
        <button class="cyber-btn" style="width:auto; padding:8px 20px" onclick="verifyTask()">VÃ‰RIFIER</button>
    </div>
</div>

<div id="tab-wallet" class="tab-content">
    <div class="glass-card">
        <h4>EXTRACTION (Retrait)</h4>
        <select id="wMethod" style="width:100%; padding:12px; background:black; color:white; border-radius:10px; margin-bottom:10px;">
            <option value="CRYPTOBOT">CryptoBot (Min 1 TON)</option>
            <option value="AIRTEL">Airtel Money (Min 3 TON)</option>
        </select>
        <input type="text" id="wDetails" placeholder="CoordonnÃ©es Airtel/Wallet" style="width:100%; padding:12px; background:black; color:white; border-radius:10px; border:1px solid #1a1a2e; margin-bottom:10px; box-sizing:border-box">
        <input type="number" id="wAmt" placeholder="Montant TON" style="width:100%; padding:12px; background:black; color:white; border-radius:10px; border:1px solid #1a1a2e; margin-bottom:10px; box-sizing:border-box">
        <button class="cyber-btn" onclick="handleWithdraw()">LANCER L'EXTRACTION</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('trade', this)"><i class="fas fa-microchip"></i><br>NEXUS</div>
    <div class="nav-item" onclick="switchTab('games', this)"><i class="fas fa-gamepad"></i><br>GAMES</div>
    <div class="nav-item" onclick="switchTab('tasks', this)"><i class="fas fa-bolt"></i><br>TASKS</div>
    <div class="nav-item" onclick="switchTab('wallet', this)"><i class="fas fa-wallet"></i><br>WALLET</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const uid = tg.initDataUnsafe.user?.id || 7019851823;
    const uname = tg.initDataUnsafe.user?.first_name || "User";
    
    document.getElementById('uid-txt').innerText = uid;

    function switchTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.getElementById('tab-'+id).classList.add('active-tab');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        tg.HapticFeedback.impactOccurred('medium');
    }

    async function sync() {
        const r = await fetch('/api/user-data', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, username:uname})
        });
        const d = await r.json();
        document.getElementById('bal').innerText = d.balance.toFixed(2);
        document.getElementById('lvl').innerText = d.level;
        document.getElementById('progress').style.width = (d.xp || 0) + "%";
    }

    async function playGame(type = null) {
        const bet = document.getElementById('bet').value;
        const game = type || document.getElementById('gameType').value;
        
        tg.HapticFeedback.impactOccurred('heavy');
        const r = await fetch('/api/play', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, bet, game})
        });
        const d = await r.json();
        
        if(d.error) return tg.showAlert(d.error);

        if(game === 'trading') {
            document.getElementById('trade-res').innerText = d.result;
            document.getElementById('trade-res').style.color = d.win > 0 ? 'var(--neon)' : 'red';
        } else {
            document.getElementById('game-res').innerText = Array.isArray(d.result) ? d.result.join('') : d.result;
        }
        
        tg.HapticFeedback.notificationOccurred(d.win > 0 ? 'success' : 'error');
        sync();
    }

    async function verifyTask() {
        const r = await fetch('/api/check-task', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid})
        });
        const d = await r.json();
        tg.showAlert(d.message);
        sync();
    }

    async function handleWithdraw() {
        const amount = document.getElementById('wAmt').value;
        const method = document.getElementById('wMethod').value;
        const details = document.getElementById('wDetails').value;
        const r = await fetch('/api/withdraw', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, amount, method, details})
        });
        const d = await r.json();
        tg.showAlert(d.message);
        sync();
    }

    sync();
</script>
</body>
</html>
