<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>STARRUSSI NEON</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600&display=swap');
        
        :root { --neon: #00f2ff; --purple: #bc13fe; --bg: #02050a; --card: #0a0f1d; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; padding-bottom: 100px; }
        
        .cyber-header { padding: 40px 20px; background: linear-gradient(180deg, #0a0f1d 0%, var(--bg) 100%); text-align: center; border-bottom: 1px solid var(--neon); box-shadow: 0 0 20px rgba(0,242,255,0.2); }
        .glitch-text { font-family: 'Orbitron', sans-serif; font-size: 40px; font-weight: 900; color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        .nav-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 20px; }
        .nav-card { background: var(--card); border: 1px solid #1a233a; padding: 15px 5px; border-radius: 12px; text-align: center; font-size: 10px; cursor: pointer; transition: 0.3s; }
        .nav-card i { font-size: 20px; color: var(--neon); margin-bottom: 5px; display: block; }
        .nav-card.active { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }

        .main-container { padding: 0 20px; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .glass-card { background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 25px; margin-bottom: 20px; }
        .btn-action { background: linear-gradient(90deg, var(--neon), var(--purple)); color: white; border: none; padding: 18px; width: 100%; border-radius: 15px; font-family: 'Orbitron'; font-weight: bold; letter-spacing: 2px; box-shadow: 0 0 15px rgba(0,242,255,0.3); }

        .game-icon { font-size: 60px; margin: 20px 0; min-height: 80px; display: flex; justify-content: center; align-items: center; }
        .spinning { animation: hyperSpin 0.1s infinite; }
        @keyframes hyperSpin { 0% { transform: scale(1); } 50% { transform: scale(1.1); filter: hue-rotate(90deg); } 100% { transform: scale(1); } }

        /* Referral List Style */
        .user-row { display: flex; justify-content: space-between; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 8px; font-size: 12px; border-left: 3px solid var(--neon); }

        /* Bottom Menu */
        .bottom-bar { position: fixed; bottom: 0; width: 100%; background: #070a14; display: flex; justify-content: space-around; padding: 20px 0; border-top: 1px solid #1a233a; }
        .bar-item { font-size: 12px; color: #4a5568; text-align: center; }
        .bar-item.active { color: var(--neon); }
    </style>
</head>
<body>

<div class="cyber-header">
    <div style="font-size: 10px; letter-spacing: 5px; opacity: 0.6;">SYSTEM CORE BALANCE</div>
    <div class="glitch-text" id="bal">0.00</div>
    <div style="font-size: 12px; color: var(--purple);">TON CRYSTALS</div>
</div>

<div class="nav-grid">
    <div class="nav-card active" onclick="showTab('play')"><i class="fas fa-rocket"></i>PLAY</div>
    <div class="nav-item" style="display:none"></div> <div class="nav-card" onclick="showTab('deposit')"><i class="fas fa-bolt"></i>LOAD</div>
    <div class="nav-card" onclick="showTab('withdraw')"><i class="fas fa-wallet"></i>CASH</div>
    <div class="nav-card" onclick="showTab('ref')"><i class="fas fa-users"></i>SQUAD</div>
</div>

<div class="main-container">
    <div id="tab-play">
        <div class="glass-card" style="text-align:center;">
            <div id="display" class="game-icon">ðŸŽ°</div>
            <select id="gameSelect" style="width:100%; padding:15px; background:black; color:var(--neon); border:1px solid var(--neon); border-radius:10px; margin-bottom:15px; font-family:'Orbitron';">
                <option value="slots">CYBER SLOTS</option>
                <option value="dice">QUANTUM DICE</option>
                <option value="mines">VOID MINES</option>
            </select>
            <input type="number" id="bet" value="0.2" style="width:100%; padding:15px; background:black; color:white; border:1px solid #333; border-radius:10px; margin-bottom:15px; box-sizing:border-box;">
            <button class="btn-action" onclick="play()">INITIATE SPIN</button>
        </div>
    </div>

    <div id="tab-deposit" style="display:none;">
        <div class="glass-card">
            <h3>RECHARGE CORE</h3>
            <button class="btn-action" style="margin-bottom:10px;" onclick="deposit('TON')">TON (CryptoBot)</button>
            <button class="btn-action" style="background:var(--purple)" onclick="deposit('STARS')">STARS (Telegram)</button>
        </div>
    </div>

    <div id="tab-withdraw" style="display:none;">
        <div class="glass-card">
            <h3>EXTRACTION</h3>
            <select id="wMethod" style="width:100%; padding:15px; background:black; color:white; border-radius:10px;">
                <option value="CRYPTOBOT">CryptoBot (1 TON min)</option>
                <option value="AIRTEL">Airtel Money (3 TON min)</option>
            </select>
            <input type="text" id="wDetails" placeholder="Wallet or Phone Number" style="width:100%; padding:15px; box-sizing:border-box; margin:10px 0; background:black; border:1px solid #333; color:white; border-radius:10px;">
            <input type="number" id="wAmt" placeholder="Amount TON" style="width:100%; padding:15px; box-sizing:border-box; background:black; border:1px solid #333; color:white; border-radius:10px;">
            <button class="btn-action" style="margin-top:15px;" onclick="withdraw()">START EXTRACTION</button>
        </div>
    </div>

    <div id="tab-ref" style="display:none;">
        <div class="glass-card">
            <h3>SQUAD LINK</h3>
            <div id="refLink" style="font-size:10px; background:black; padding:15px; border-radius:10px; word-break:break-all; border:1px dashed var(--neon);"></div>
            <button class="btn-action" style="margin-top:15px;" onclick="shareRef()">COPY & SHARE</button>
        </div>
        <div class="glass-card">
            <h3>ACTIVE SQUAD (<span id="count">0</span>)</h3>
            <div id="list"></div>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const uid = tg.initDataUnsafe.user?.id || 7019851823;
    const uname = tg.initDataUnsafe.user?.first_name || "Pilot";
    const refParam = new URLSearchParams(window.location.search).get('tgWebAppStartParam');
    let link = "";

    function showTab(t) {
        document.querySelectorAll('[id^="tab-"]').forEach(el => el.style.display = 'none');
        document.getElementById('tab-'+t).style.display = 'block';
        document.querySelectorAll('.nav-card').forEach(el => el.classList.remove('active'));
        tg.HapticFeedback.impactOccurred('medium');
    }

    async function sync() {
        const r = await fetch('/api/user-data', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, username:uname, refId:refParam})
        });
        const d = await r.json();
        document.getElementById('bal').innerText = d.balance.toFixed(2);
        link = d.refLink;
        document.getElementById('refLink').innerText = link;
        document.getElementById('count').innerText = d.invitedUsers.length;
        document.getElementById('list').innerHTML = d.invitedUsers.map(u => `
            <div class="user-row"><span>${u.name}</span><span>${u.date}</span></div>
        `).join('') || "No squad members yet.";
    }

    async function play() {
        const bet = document.getElementById('bet').value;
        const game = document.getElementById('gameSelect').value;
        document.getElementById('display').classList.add('spinning');
        
        const r = await fetch('/api/play', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, bet, game, minesCount: 3})
        });
        const d = await r.json();
        
        setTimeout(() => {
            document.getElementById('display').classList.remove('spinning');
            if(d.error) return tg.showAlert(d.error);
            document.getElementById('display').innerText = Array.isArray(d.result) ? d.result.join('') : d.result;
            tg.HapticFeedback.notificationOccurred(d.win > 0 ? 'success' : 'error');
            sync();
        }, 800);
    }

    async function deposit(asset) {
        const amt = prompt("Amount:");
        const r = await fetch('/api/deposit', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, asset, amount:amt})
        });
        const d = await r.json();
        if(d.url) tg.openTelegramLink(d.url);
    }

    async function withdraw() {
        const amount = document.getElementById('wAmt').value;
        const method = document.getElementById('wMethod').value;
        const details = document.getElementById('wDetails').value;
        const r = await fetch('/api/withdraw', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id:uid, amount, method, details})
        });
        const d = await r.json();
        tg.showAlert(d.message);
        sync();
    }

    function shareRef() {
        tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=Join my cyber squad!`);
    }

    sync();
</script>
</body>
</html>
